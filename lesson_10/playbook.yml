---
- name: install
  hosts: all
  become: true


  tasks:

    - name: install docker
      apt:
        name: docker.io
        state: present


- name: up nexus
  hosts: nexus
  become: true

  tasks:
    - name: start container nexus
      docker_container:
        name: nexus
        image: sonatype/nexus3
        user: root
        volumes:
          - /app/nexus:/nexus-data
        ports:
          - 8081:8081
        restart: true


- name: up jenkins
  hosts: jenkins
  become: true

  tasks:
    - name: start container jenkins
      docker_container:
        name: jenkins
        image: jenkins/jenkins:lts-jdk11
        user: root
        volumes:
          - /app/jenkins:/var/jenkins_home
        ports:
          - 8082:8080
          - 50000:50000
        restart: true


- name: install agent one
  hosts: agent_one
  become: true

  tasks:
    - name: start agent one
      docker_container:
        name: agent_one
        image: jenkins/ssh-agent:jdk11
        user: root
        restart: true
        volumes:
          - /app/jenkins/agent/java:/usr/local/openjdk-11/bin/java
          - /app/jenkins/agent/:/home/jenkins/agent
          - /app/jenkins/agent/git:/home/jenkins/agent/workspace/
        #    command: "apt-get update -y && apt-get upgrade -y && apt-get install git -y"
        expose:
          - 22
        env:
          JENKINS_AGENT_SSH_PUBKEY: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC9i3jRWpjicRhw8h377DczNABe8IomxAnJMJE9wdA0+lG28++nyEoqNQ2ezcXUpILjM6izj+yqQT1LLcFD+VZ6wNwv4qOufVjRHpSDW32m/V9o03D8KTo7BdN29pdLlryc69b/guglr5hu79NvaHdZ4vnkZdf27oucqf+Da1sckC+681Ps13trdgAFmORWEv+FHHM6J84Nnk8hL92ytZJ8Hd9xM1yjbjmLjpZORs21ITwnpVeBNXp1654tlxpoBe2pFsYXOtSJJMdYNoz5tF9lCm87vtSZkWIEB/7ibrXPlEHKuHTbRelkpXIUL4ibOBVSisTWPmwnoPmTkK2ZC/Gr4KlWI7j7HFvy90fRKijf+e+E0I8blJY87AhLGkvcReEFVcMC4zRX1EEkIQU9tpFfm0at3Lk3/5PW8pf9fwex+bXmWslBZivfKuzG80GWfYYDpydV2a32WC3x5aRtLj+hRo0GRuc5OCj1HGGu3Qs/ZqzySsK4pJDu2ZCjP6ze4SU= root@ansible"


- name: install agent two
  hosts: agent_two
  become: true

  tasks:
    - name: start agent two
      docker_container:
        name : agent_two
        image: jenkins/ssh-agent:jdk11
        user: root
        restart: true
        volumes:
          - /app/jenkins/agent/java:/usr/local/openjdk-11/bin/java
          - /app/jenkins/agent/:/home/jenkins/agent
        expose:
          - 22
        env:
          JENKINS_AGENT_SSH_PUBKEY: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC9i3jRWpjicRhw8h377DczNABe8IomxAnJMJE9wdA0+lG28++nyEoqNQ2ezcXUpILjM6izj+yqQT1LLcFD+VZ6wNwv4qOufVjRHpSDW32m/V9o03D8KTo7BdN29pdLlryc69b/guglr5hu79NvaHdZ4vnkZdf27oucqf+Da1sckC+681Ps13trdgAFmORWEv+FHHM6J84Nnk8hL92ytZJ8Hd9xM1yjbjmLjpZORs21ITwnpVeBNXp1654tlxpoBe2pFsYXOtSJJMdYNoz5tF9lCm87vtSZkWIEB/7ibrXPlEHKuHTbRelkpXIUL4ibOBVSisTWPmwnoPmTkK2ZC/Gr4KlWI7j7HFvy90fRKijf+e+E0I8blJY87AhLGkvcReEFVcMC4zRX1EEkIQU9tpFfm0at3Lk3/5PW8pf9fwex+bXmWslBZivfKuzG80GWfYYDpydV2a32WC3x5aRtLj+hRo0GRuc5OCj1HGGu3Qs/ZqzySsK4pJDu2ZCjP6ze4SU= root@ansible"


